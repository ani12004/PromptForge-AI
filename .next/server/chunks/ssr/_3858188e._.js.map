{"version":3,"sources":["../../../../app/actions/subscription.ts","../../../../app/actions/auth.ts","../../../../node_modules/%40clerk/nextjs/dist/esm/app-router/server-actions.js","../../../../app/actions/notifications.ts","../../../../.next-internal/server/app/studio/notifications/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\r\n\r\nimport { auth } from \"@clerk/nextjs/server\";\r\nimport { createClerkSupabaseClient } from \"@/lib/supabaseClient\";\r\n\r\nexport async function getUserSubscription() {\r\n    try {\r\n        const { userId, getToken } = await auth();\r\n        if (!userId) return \"free\";\r\n\r\n        const token = await getToken({ template: \"supabase\" });\r\n        const supabase = createClerkSupabaseClient(token);\r\n\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('subscription_tier')\r\n            .eq('id', userId)\r\n            .single();\r\n\r\n        return (profile?.subscription_tier || \"free\").toLowerCase();\r\n    } catch (error) {\r\n        console.error(\"Error fetching subscription:\", error);\r\n        return \"free\";\r\n    }\r\n}\r\n","\"use server\"\r\n\r\nimport { auth } from \"@clerk/nextjs/server\"\r\nimport { createClerkSupabaseClient } from \"@/lib/supabaseClient\"\r\n\r\nexport async function getUserRole() {\r\n    const { userId, getToken } = await auth()\r\n\r\n    if (!userId) {\r\n        return null\r\n    }\r\n\r\n    try {\r\n        const token = await getToken({ template: \"supabase\" })\r\n        const supabase = createClerkSupabaseClient(token)\r\n        const { data: profile } = await supabase\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', userId)\r\n            .single()\r\n\r\n        return profile?.role || 'user'\r\n    } catch (error) {\r\n        console.error(\"Failed to fetch user role\", error)\r\n        return 'user'\r\n    }\r\n}\r\n","\"use server\";\nimport { cookies } from \"next/headers\";\nasync function invalidateCacheAction() {\n  void (await cookies()).delete(`__clerk_invalidate_cache_cookie_${Date.now()}`);\n}\nexport {\n  invalidateCacheAction\n};\n","\"use server\"\r\n\r\nimport { auth } from \"@clerk/nextjs/server\"\r\nimport { createClerkSupabaseClient } from \"@/lib/supabaseClient\"\r\n\r\nexport async function getNotifications() {\r\n    const { getToken, userId } = await auth()\r\n\r\n    // We use the authenticated client so RLS applies\r\n    const token = await getToken({ template: \"supabase\" })\r\n    const supabase = createClerkSupabaseClient(token)\r\n\r\n    // Fetch Global (user_id is null) OR Personal (user_id = current)\r\n    // The RLS policy I gave the user handles this automatically `(auth.uid() = user_id or user_id is null)`\r\n    // So we just select * from notifications.\r\n\r\n    const { data, error } = await supabase\r\n        .from('notifications')\r\n        .select('*')\r\n        .order('created_at', { ascending: false })\r\n        .limit(20)\r\n\r\n    if (error) {\r\n        console.error(\"Error fetching notifications\", error)\r\n        return []\r\n    }\r\n\r\n    return data\r\n}\r\n","export {getUserSubscription as '0003a3dcf615081a16c914805a79b1208e05658d88'} from 'ACTIONS_MODULE0'\nexport {getUserRole as '0051101ac87c471b7462d604cadbab8a2e54996392'} from 'ACTIONS_MODULE1'\nexport {detectKeylessEnvDriftAction as '00d33c04adba09f9320585b6cd2442fddc67121317'} from 'ACTIONS_MODULE2'\nexport {invalidateCacheAction as '00fb695b95eb42dc75b9b2e7e86571a2d3342b32bb'} from 'ACTIONS_MODULE3'\nexport {createOrReadKeylessAction as '000c5950602641cd8b0661a788cb4fb705def1b4b1'} from 'ACTIONS_MODULE2'\nexport {collectKeylessMetadata as '008a5782a58bd8eba0077f5b1e478761fed9d410df'} from 'ACTIONS_MODULE4'\nexport {formatMetadataHeaders as '40e8dbb7737be346be89256c32890a354586b96faf'} from 'ACTIONS_MODULE4'\nexport {createOrReadKeylessAction as '000c5950602641cd8b0661a788cb4fb705def1b4b1'} from 'ACTIONS_MODULE2'\nexport {deleteKeylessAction as '0064afb0bd84c5266927f4777c8f0ddd5c7e626c6a'} from 'ACTIONS_MODULE2'\nexport {detectKeylessEnvDriftAction as '00d33c04adba09f9320585b6cd2442fddc67121317'} from 'ACTIONS_MODULE2'\nexport {syncKeylessConfigAction as '40efc55e4105d4adbc9874f14cc1c800be70aff8bc'} from 'ACTIONS_MODULE2'\nexport {syncKeylessConfigAction as '40efc55e4105d4adbc9874f14cc1c800be70aff8bc'} from 'ACTIONS_MODULE2'\nexport {deleteKeylessAction as '0064afb0bd84c5266927f4777c8f0ddd5c7e626c6a'} from 'ACTIONS_MODULE2'\nexport {getNotifications as '00c4a02621483e8dff214888ef15ea960693f65d2f'} from 'ACTIONS_MODULE5'\n"],"names":[],"mappings":"mEAEA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,oBAEO,eAAe,IAClB,GAAI,CACA,GAAM,QAAE,CAAM,UAAE,CAAQ,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,IAAA,AAAI,IACvC,GAAI,CAAC,EAAQ,MAAO,OAEpB,IAAM,EAAQ,MAAM,EAAS,CAAE,SAAU,UAAW,GAC9C,EAAW,CAAA,EAAA,EAAA,yBAAA,AAAyB,EAAC,GAErC,CAAE,KAAM,CAAO,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,YACL,MAAM,CAAC,qBACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,MAAO,CAAC,GAAS,mBAAqB,MAAA,CAAM,CAAE,WAAW,EAC7D,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,+BAAgC,GACvC,MACX,CACJ,CCnBO,eAAe,IAClB,GAAM,QAAE,CAAM,CAAE,UAAQ,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,IAAA,AAAI,IAEvC,GAAI,CAAC,EACD,MADS,CACF,KAGX,GAAI,CACA,IAAM,EAAQ,MAAM,EAAS,CAAE,SAAU,UAAW,GAC9C,EAAW,CAAA,EAAA,EAAA,yBAAA,AAAyB,EAAC,GACrC,CAAE,KAAM,CAAO,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,YACL,MAAM,CAAC,QACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,OAAO,GAAS,MAAQ,MAC5B,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,4BAA6B,GACpC,MACX,CACJ,iCDrBsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,8ECAA,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,uCCJtB,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,eAAe,IACR,AAAC,OAAM,CAAA,EAAA,EAAA,OAAA,AAAO,GAAA,CAAE,CAAE,MAAM,CAAC,CAAC,gCAAgC,EAAE,KAAK,GAAG,GAAA,CAAI,CAC/E,iCAFe,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,0FCAf,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,IAClB,GAAM,UAAE,CAAQ,QAAE,CAAM,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,IAAA,AAAI,IAGjC,EAAQ,MAAM,EAAS,CAAE,SAAU,UAAW,GAC9C,EAAW,CAAA,EAAA,EAAA,yBAAA,AAAyB,EAAC,GAMrC,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EACzB,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,WAEX,AAAI,GACA,IADO,IACC,KAAK,CAAC,+BAAgC,GACvC,EAAE,EAGN,CACX,0CAvBsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,8DCLtB,IAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OAQA,EAAA,EAAA,CAAA,CAAA","ignoreList":[2]}