{"version":3,"sources":["../../../../app/gamification-debug/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useUser } from \"@clerk/nextjs\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { Loader2 } from \"lucide-react\"\r\nimport { createClerkSupabaseClient } from \"@/lib/supabaseClient\"\r\n\r\nexport default function DebugPage() {\r\n    const { user, isLoaded, isSignedIn } = useUser()\r\n    const [dbProfile, setDbProfile] = useState<any>(null)\r\n    const [dbBadges, setDbBadges] = useState<any[]>([])\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    useEffect(() => {\r\n        if (!isLoaded || !user) return\r\n\r\n        const checkDb = async () => {\r\n            setLoading(true)\r\n            try {\r\n                // We need to use a client-side supabase instance with the Clerk token\r\n                // But for a quick debug, we can try to hit an action or just use standard fetch if we have a public API\r\n                // Or better, let's just use the server action pattern but explicitly invoked here\r\n\r\n                // Since we can't easily import the server action with separate client/server context in this simple file,\r\n                // let's just ask the user to verify the ID match visually first.\r\n\r\n                // Actually, we can try to verify the profile existence via a simple fetch if we had an endpoint.\r\n                // Let's rely on visual ID inspection.\r\n\r\n            } catch (e: any) {\r\n                setError(e.message)\r\n            } finally {\r\n                setLoading(false)\r\n            }\r\n        }\r\n\r\n        checkDb()\r\n    }, [isLoaded, user])\r\n\r\n    if (!isLoaded) return <div>Loading Clerk...</div>\r\n\r\n    if (!isSignedIn) return <div>Not signed in</div>\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-black text-white p-12 font-mono\">\r\n            <h1 className=\"text-2xl text-red-500 font-bold mb-8\">Gamification Debugger</h1>\r\n\r\n            <div className=\"space-y-8\">\r\n                <div className=\"border border-white/20 p-6 rounded-lg\">\r\n                    <h2 className=\"text-xl font-bold mb-4 text-brand-purple\">1. Clerk Session Info</h2>\r\n                    <div className=\"space-y-2\">\r\n                        <p><span className=\"text-gray-500\">User ID:</span> <span className=\"text-green-400\">{user.id}</span></p>\r\n                        <p><span className=\"text-gray-500\">Email:</span> {user.primaryEmailAddress?.emailAddress}</p>\r\n                    </div>\r\n                    <div className=\"mt-4 p-4 bg-gray-900 rounded text-sm text-yellow-400\">\r\n                        ⚠️ Please check your Supabase \"user_badges\" table. <br />\r\n                        Does the <code>user_id</code> column match EXACTLY with <span className=\"text-green-400\">{user.id}</span>?\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"border border-white/20 p-6 rounded-lg\">\r\n                    <h2 className=\"text-xl font-bold mb-4 text-blue-400\">2. SQL Query Generator</h2>\r\n                    <p className=\"mb-4 text-sm text-gray-400\">Run this SQL EXACTLY to fix the ID mismatch manually if the email lookup failed:</p>\r\n\r\n                    <div className=\"bg-[#111] p-4 rounded border border-white/10 overflow-x-auto\">\r\n                        <pre className=\"text-sm text-gray-300\">\r\n                            {`INSERT INTO user_badges (user_id, badge_id)\r\nSELECT '${user.id}', id \r\nFROM badges \r\nWHERE name = 'Legend of PromptForge'\r\nON CONFLICT (user_id, badge_id) DO UPDATE SET earned_at = NOW();`}\r\n                        </pre>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAIe,SAAS,IACpB,GAAM,CAAE,MAAI,UAAE,CAAQ,YAAE,CAAU,CAAE,CAAG,CAAA,EAAA,EAAA,OAAO,AAAP,IACjC,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAM,MAC1C,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAQ,EAAE,EAC5C,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,YA4BlD,CA1BA,CAAA,EAAA,AA0BI,EA1BJ,SAAA,AAAS,EAAC,KACD,AAAL,GAAkB,CAAd,EAsBJ,CApBgB,EAFQ,GAAP,KAGb,GAAW,GAeP,GAAW,EAEnB,IAGJ,EAAG,CAAC,EAAU,EAAK,EAEd,GAEA,EAGD,CAAA,EAAA,EAAA,AALW,IAKX,CAHa,CAGZ,MAAA,CAAI,UAAU,4DACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,0BAErD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,oDAA2C,0BACzD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACX,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,yBAAgB,aAAe,IAAC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,0BAAkB,EAAK,EAAE,MAC5F,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,yBAAgB,WAAa,IAAE,EAAK,mBAAmB,EAAE,mBAEhF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iEAAuD,sDACf,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAA,GAAK,YAChD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,YAAc,8BAA2B,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,0BAAkB,EAAK,EAAE,GAAQ,UAIjH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,gDAAuC,2BACrD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,qFAE1C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wEACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCACV,CAAC;QACtB,EAAE,EAAK,EAAE,CAAC;;;gEAG8C,CAAC,cA7BrC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAI,kBAFP,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAI,oBAsC/B"}